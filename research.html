<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Research | Vision Lab</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="logo">
        <span class="logo-title">Vision Lab</span>
        <span class="logo-subtitle">NYCU • Computer Vision & AI</span>
      </a>
      <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
        <span></span><span></span><span></span>
      </button>
      <nav class="site-nav" id="siteNav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="advisor.html" class="nav-link">Advisor</a>
        <a href="members.html" class="nav-link">Members</a>
        <a href="research.html" class="nav-link active">Research</a>
        <a href="courses.html" class="nav-link">Courses</a>
        <a href="http://vlab.iee.nycu.edu.tw/" class="nav-link">Old Website</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="page-hero research-page">
      <div class="container">
        <h1>Research</h1>
        <p>Recent and previous projects in computer vision, AI, and signal processing</p>
      </div>
    </section>

    <!-- Recent Projects -->
    <section class="section research-section">
      <div class="container">
        <h2>Recent Projects</h2>
        <div id="recent-projects" class="project-list">
          <!-- Fill by JS -->
        </div>
      </div>
    </section>

    <!-- Previous Projects -->
    <section class="section">
      <div class="container">
        <h2>Previous Projects</h2>
        <div id="previous-projects" class="project-list">
          <!-- Fill by JS -->
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>
        <strong>Vision Lab, NYCU</strong><br />
        Rm.634, Engineering Building IV, No.1001 Daxue Road, Hsinchu, Taiwan 300, ROC<br />
        Tel: +886-3-5712121 ext.54177
      </div>
      <div class="footer-meta">
        <span>© NCTU / NYCU Vision Lab</span>
      </div>
    </div>
  </footer>

  <script src="assets/js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      loadResearchProjects();
    });

    async function loadResearchProjects() {
      const recentContainer = document.getElementById('recent-projects');
      const previousContainer = document.getElementById('previous-projects');

      try {
        const res = await fetch('data/research/index.json');
        const projects = await res.json();

        for (const proj of projects) {
          // Read markdown description
          const descRes = await fetch(`data/research/${proj.file}`);
          const descText = await descRes.text();
          const descHtml = marked.parse(descText);

          // Multiple images
          let imagesHtml = '';
          if (proj.images && proj.images.length > 0) {
            imagesHtml = proj.images
              .map(img => {
                const caption = img.caption
                  ? `<figcaption class="project-caption">${img.caption}</figcaption>`
                  : '';
                return `
                  <figure class="project-figure">
                    <img src="${img.src}" alt="${img.alt || ''}" />
                    ${caption}
                  </figure>
                `;
              })
              .join('');
          }

          // Video links
          let videosHtml = '';
          if (proj.videos && proj.videos.length > 0) {
            const links = proj.videos
              .map(v => `<a href="${v.url}" target="_blank" rel="noopener">${v.label}</a>`)
              .join(' • ');
            videosHtml = `
              <p><strong>Demo videos:</strong><br />
                ${links}
              </p>
            `;
          }

          const article = document.createElement('article');
          article.className = 'project';

          // Fill article content
          article.innerHTML = `
            <div class="project-text">
              <div class="project-desc">
                ${descHtml}
                ${videosHtml}
              </div>
            </div>
            <div class="project-media">
              ${imagesHtml}
            </div>
          `;

          const targetContainer =
            proj.group === 'previous' ? previousContainer : recentContainer;
          targetContainer.appendChild(article);
        }
      } catch (err) {
        console.error('Failed to load research projects:', err);
        recentContainer.innerHTML = '<p>Failed to load research projects.</p>';
      }
    }
  </script>
</body>
</html>
